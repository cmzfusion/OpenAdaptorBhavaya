<html>
<head>
<style type="text/css">
 #level0 { background: #99CC00 ! important}
 #level1 { background: #CCFFFF ! important}
 #level2 { background: #FFCC99 ! important}
 #optional { background: #CCFFCC ! important}
</style>
<title>Bhavaya - Quickstart - Format of the Schema File</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">

<div id="domainhome" class="app">
  <div class="h3" id="domaincontent">

  <a name="top">
  <h3>Quickstart Guides</h3>
  </a>
 
  <h4>The Persistence Layer - Format of schema.xml</h4>

  <p>The schema file contains entries for each class (or type) to be
     inflated from the database. For each type, the datasource to use
     and the type's properties are set. The overall structure is:<pre>
  &lt;?xml version="1.0" encoding="ISO-8859-1"?&gt; 

  &lt;schema&gt;

     &lt;<a href="#include">include</a> schema="schemaMasterfile.xml"/&gt;
       ...
     &lt;include schema="..."/&gt;

     &lt;<a href="#type">type</a> name="org.example.Instrument"
        generatedClass="org.example.generatedBeans.Instrument"
        generate="true"
        beanFactoryType="org.bhavaya.db.SqlBeanFactory"
        defaultDataSource="exampleDatabase"
        sql="SELECT INSTRUMENT.* FROM INSTRUMENT"
        dataVolatility="HIGH"
        dataQuantity="HIGH"&gt;
     
      &lt;<a href="#property">property</a> name="instrumentId" type="int" column="INSTRUMENT_ID"/&gt;
      &lt;property ... /&gt;

      &lt;<a href="#foreignKeyProperty">foreignKeyProperty</a> name="currency"
         type="org.example.Currency"
         cardinality="ONE"
         foreignIndex="byCurrencyCode"
         lazy="true">    
        &lt;column name="CURRENCY"/&gt;
      &lt;/foreignKeyProperty&gt;

      &lt;foreignKeyProperty&gt;
         ...
      &lt;/foreignKeyProperty&gt;

      &lt;<a href="#constructorProperty">constructorProperty</a> name="instrumentQuantity" 
         type="Quantity"
         class="org.bhavaya.util.LazyQuantity"&gt;
        &lt;column name="PRICE" source="instrumentQuantity.amount" type="double"/&gt;
	&lt;defaultValue value="5" type="int"/&gt;
	&lt;property name="currency.code" type="java.lang.String"/&gt;
      &lt;/constructorProperty&gt;

      &lt;constructorProperty&gt;
         ...
      &lt;/constructorProperty&gt;


      &lt;<a href="#subClassMappings">subClassMappings</a>&gt;
         &lt;table name="INSTRUMENT" default="true"&gt;
	   &lt;subClassMapping name="org.example.Bond"&gt;
	     &lt;criterion leftOperand="INSTRUMENT_TYPE_ID" rightOperand="0" operator="="/&gt;
	   &lt;/subClassMapping&gt;

	   &lt;subClassMapping&gt;
	      ...
	   &lt;/subClassMapping&gt;

         &lt;/table&gt;
       &lt;/subClassMappings&gt;
       
       &lt;<a href="#index">index</a> name="byInstrument" unique="false"&gt;
         &lt;column name="INSTRUMENT_ID" tableName="INSTRUMENT_RATING"/&gt;
       &lt;/index&gt;
         ...
       &lt;index ...&gt;
         ...
       &lt;/index&gt;
       
       &lt;<a href="#primaryKey">primaryKey</a>&gt;
         &lt;column name="INSTRUMENT_ID" tableName="INSTRUMENT" idFactory="org.bhavaya.db.IncrementMaxValueIdFactory"/&gt;
       &lt;/primaryKey&gt;
     &lt;/type&gt;
    
     &lt;type&gt;
       ...
     &lt;/type&gt;
  
  &lt;/schema&gt;
  </pre>
  </p>

  <p>Where the specific tags have the following attributes <span
     id="optional">(indicates optional attributes)</span>:</p>

<!-- INCLUDE ---------------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="include">
        <th colspan="3">&lt;include A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>schema</td>
	<td>schemaMasterfile.xml</td>
	<td>Name of the schema file to include</td>
      </tr>
    </table>
  </p>

<p><a href="#top">top</a></p>

<!--  TYPE ------------------------------------------------------------------>
  <p>
    <table width="100%">
      <tr><a name="type">
        <th colspan="3">&lt;type A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>Bond</td>
        <td>Name of the class (type). This is the Java class name, and
            is the fully qualified name of the class as it would be
            referenced within Java source code. This may be identical
            to the generatedClass below, in this case it will be generated
            and does not rely on an abstract class definition.</td>
      </tr>
      <tr>
        <td>generatedClass</td>
        <td>generatedBeans.Bond</td>
        <td>This is name of the class that is generated by the
            persistence layer and is the name used internally by it. </td>
      </tr>
      <tr id="optional">
        <td>superType</td>
        <td>Instrument</td>
        <td>Parent for this class, if it is a subclass.</td>
      </tr>
      <tr>
        <td>generate</td>
        <td>true</td>
        <td>[true||false] Specifies whether or not to generate the
            class from database data.</td>
      </tr>
      <tr>
        <td>beanFactoryType</td>
        <td>org.bhavaya.db.SqlBeanFactory</td>
        <td>The beanfactory to use when generating objects of this
            type. Allowed values are:
            [org.bhavaya.beans.DefaultBeanFactory ||
            org.bhavaya.db.SqlBeanFactory ||
            org.bhavaya.db.StoredProcedureBeanFactory ||
	    org.bhavaya.beans.WebServiceBeanFactory] </td>
      </tr>
      <tr id="optional">
        <td>referenceType</td>
        <td>STRONG</td>
        <td>[STRONG||WEAK||SOFT] WHICH REFERENCE IS THIS??</td>
      </tr>
      <tr>
        <td>defaultDataSource</td>
        <td>example2Database</td>
        <td>datasource to use as specified in application.xml</td>
      </tr>
      <tr id="optional">
        <td>transformClass</td>
        <td>com.somewhere.WebService.InfoToInfoTransform</td>
        <td>Used by the WebServiceBeanFactory</td>
      </tr>
      <tr>
        <td>sql</td>
        <td>"SELECT INSTRUMENT.* FROM INSTRUMENT"</td>
        <td>sql command that should be issued to retrieve all objects of
        this type from the database.</td>
      </tr>
      <tr id="optional">
        <td>storedProcedure</td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>dataVolatility</td>
        <td>HIGH</td>
        <td rowspan="2">[HIGH||LOW] These are optimisation settings, and should
        both be high if you are unsure. These settings determine
        whether the entire data set is cached when a request for one
        member is received, and also whether or not / how often to reload the
        entire set if one item changes.</td>
      </tr>
      <tr>
        <td>dataQuantity</td>
        <td>HIGH</td>
        <td></td>
      </tr>
      <tr id="optional">
        <td>toStringCode</td>
        <td>return (getAmountIssued() != null ? getAmountIssued().toString() : null);</td>
        <td>Java code to be used for this type's toString method. The
        example given assumes that Instrument has a property
        AmountIssued, returning an object whose type already has a
        defined toString method.</td>
      </tr>
    </table>
  </p>

<p><a href="#top">top</a></p>
  
<!-- PROPERTY ---------------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="property">
        <th colspan="3">&lt;property A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>description</td>
        <td>name of the property, i.e. this class will have a method
            getDescription()</td>
      </tr>
      <tr>
        <td>type</td>
        <td>java.lang.String</td>
        <td>Return type of the getDescription() method</td>
      </tr>
      <tr id="optional">
        <td>cardinality</td>
        <td>ONE</td>
        <td>[ONE||MANY] If MANY a BeanCollection will be returned
        rather than a single bean/object</td>
      </tr>
      <tr>
        <td>column</td>
        <td>DESCRIPTION</td>
        <td>The name of the column in the database from which this
        property will be obtained.</td>
      </tr>
    </table>
  </p>

<p><a href="#top">top</a></p>
  
<!-- FOREIGNKEYPROPERTY ------------------------------------------------------>
  <p>
    <table width="100%">
      <tr><a name="foreignKeyProperty">
        <th colspan="3">&lt;foreignKeyProperty A="B" ... &gt; <a
        href="persist_schema.html#foreign">(more info)</a></th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>currency</td>
        <td>Name of the property (class has getName() method).</td>
      </tr>
      <tr>
        <td>type</td>
        <td>org.example.Currency</td>
        <td>Type of returned property.</td>
      </tr>
      <tr>
        <td>cardinality</td>
        <td>ONE</td>
        <td>[ONE||MANY] If MANY a BeanCollection will be returned
        rather than a single bean.</td>
      </tr>
      <tr id="optional">
        <td>foreignIndex</td>
	<td>byInstrument</td>
	<td>Indexing property of the foreign class to use. This is
        required when the foreign index is not the primary key of the
        foreign table.</td>
      </tr>
      <tr>
        <td>lazy</td>
        <td>true</td>
        <td>[true||false] Only inflate the property when required,
            rather than on instantiating the bean.</td>
      </tr>
   </table>
  </p>
 
  <p>
    <table width="100%">
      
    <tr><td width="20%"></td>
    
    <td width="80%">
    <table width="100%">
      <tr><a name="column">
        <th colspan="3">&lt;column A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
        <th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>CURRENCY</td>
        <td>Name of the column (for this type i.e. INSTRUMENT) to use to obtain the key for the foreign type.
            Note that this key may be used against the foreign index, if one has been specified, rather than against
            the foreign type's primary key.</td>
      </tr>
    </table>
    </td></tr>

    </table>
  </p>

<p><a href="#top">top</a></p>

<!-- CONSTRUCTORPROPERTY ----------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="constructorProperty">
        <th colspan="3">&lt;constructorProperty A="B" ... &gt; <a
        href="persist_schema.html#constructorproperty">(more info)</a></th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>name</td>
	<td>instrumentQuantity</td>
	<td>Name for this property (i.e. there'll be a
            getInstrumentQuantity() method).</td>
      </tr>
      <tr>
        <td>type</td>
	<td>org.example.Quantity</td>
	<td>Return type of this property.</td>
      </tr>
      <tr id="optional">
        <td>class</td>
	<td>org.bhavaya.util.LazyQuantity</td>
	<td>Defaults to type if not specified. The actual class returned, i.e. the class used to implement
	    the type</td>
      </tr>
      <tr id="optional">
        <td>lazy</td>
	<td>true</td>
	<td>[true||false] Only inflate the property when required,
            rather than on instantiating the bean.</td>
      </tr>
    </table>
  </p>

  <p>
    <table width="100%">
      
      <tr><td width="20%"></td>
    
        <td width="80%">
    
          <table>
          <tr>
            <th colspan="3" width="100%">&lt;column A="B" ...&gt;</th>
          </tr>
          <tr>
            <th>A</th>
	    <th>B - example value</th>
  	    <th>description</th>
          </tr>
          <tr>
            <td>name</td>
       	    <td>QUANTITY</td>
  	    <td>Name of the table column to use to obtain one of the
  	    constructor's values.</td>
          </tr>
          <tr>
            <td>source</td>
       	    <td>instrumentQuantity.amount</td>
  	    <td>This field is only used when the bean is persisted,
  	    that is, written back to the database. This is the source
  	    for the data when persisting this
  	    field. instrumentQuantity is of type Quantity, which has a
  	    getAmount() method that will be used to write the value to
  	    the QUANTITY database column.</td>
          </tr>
          <tr>
            <td>type</td>
       	    <td>double</td>
  	    <td>Type of the value in this table column</td>
          </tr>
          </table>
    
        </td>
    
      </tr>
    </table>
  
  </p>
  <p>
    <table width="100%">
      
      <tr><td width="20%"></td>
    
        <td width="80%">
    
          <table>
          <tr><a name="defaultvalue">
            <th colspan="3" width="100%">&lt;defaultValue A="B" ...&gt;</th>
          </a></tr>
          <tr>
            <th>A</th>
	    <th>B - example value</th>
  	    <th>description</th>
          </tr>
          <tr>
            <td>value</td>
       	    <td>5</td>
	    <td>Fixed value to be passed to the constructor. (Also see
                below.)</td>
          </tr>
          <tr>
            <td>type</td>
       	    <td>int</td>
  	    <td>Type of the this value.</td>
          </tr>
	  
	  <tr><td colspan="3">The value for defaultValue can be a
                string that will be translated at the time the schema
                is loaded. If the type is java.util.Calendar,
                java.sql.Date or java.util.Date then the following
                strings will be translated to the corresponding dates
                (start times are referenced to GMT 0000):
		<table> 
		<tr><th>value</th><th>translates to</th></tr>
                <tr><td>T</td><td>Start of today</td></tr> 
		<tr><td>T-1d</td><td>Start of yesterday</td></tr> 
		<tr><td>W</td><td>Start of week</td></tr>
		<tr><td>M</td><td>Start of month</td></tr>
		<tr><td>Y</td><td>Start of year</td></tr>
		<tr><td>-infinity</td><td>Time beginning</td></tr>
		<tr><td>infinity</td><td>Time end</td></tr>
                </table>
             </td>
	   </tr>
	</table>

      </tr>
    </table>
  
  </p>
  
  <p>
    <table width="100%">
      
      <tr><td width="20%"></td>
    
        <td width="80%">
    
          <table>
          <tr>
            <th colspan="3" width="100%">&lt;property A="B" ...&gt;</th>
          </tr>
          <tr>
            <th>A</th>
	    <th>B - example value</th>
  	    <th>description</th>
          </tr>
          <tr>
            <td>name</td>
       	    <td>description</td>
  	    <td>Name of the property (of this type) to be used when
  	    determining a value for the constructor of the derived
  	    type. This property can be derived from a foreignKey
  	    property. e.g. the foreign property currency could be
  	    accessed, and it's code property obtained by setting the
  	    name to currency.code.</td>
          </tr>
          <tr>
            <td>type</td>
       	    <td>java.lang.String</td>
  	    <td>Return type of the property name specified above.</td>
          </tr>
          </table>
    
        </td>
    
      </tr>
    </table>
  
  </p>

<p><a href="#top">top</a></p>

<!-- SUBCLASSMAPPINGS -------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="subClassMappings">
        <th>subClassMappings</th></a>
      </tr>
    </table>
  </p>

  <p><pre>
      &lt;subClassMappings&gt;
         &lt;table name="INSTRUMENT" default="true"&gt;
	   &lt;subClassMapping name="org.example.Bond"&gt;
	     &lt;criterion leftOperand="INSTRUMENT_TYPE_ID" rightOperand="0" operator="="/&gt;
	   &lt;/subClassMapping&gt;

	   &lt;subClassMapping&gt;
	      ...
	   &lt;/subClassMapping&gt;

         &lt;/table&gt;
       &lt;/subClassMappings&gt;
</pre></p>

  <p>
    <ul>
      
      <li>Subclass mappings are described in more detail <a
          href="persist_schema.html#subclasses">here</a>.</li>
      <li>Table name is the name of the table of the parent (this)
          class.</li>
      <li>default = ???</li>
      <li>subClassMapping name is the name of the class that is a
          subclass of this class</li>
      <li>criterion allows the subclassing to be based on the value of
          one of the parent table's cells. Allowed operators are: 
	  <table>
	    <tr><td>=,==</td><td>equal to</td></tr>
	    <tr><td>!=, &lt;&gt;</td><td>Not equal to</td></tr>
	    <tr><td>IN</td><td>database entry for leftOperand is in the comma
          separated list specified as the rightOperand</td></tr>
	    <tr><td>NOT IN</td><td>database entry for leftOperand is not
          in the comma separated list specified as the rightOperand</td></tr>
	    <tr><td></td><td></td></tr>
	  </table></li>
    </ul>
  </p>

<p><a href="#top">top</a></p>
    
<!-- INDEX ------------------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="index">
        <th colspan="3">&lt;index A="B" ... &gt;</th></a>
     </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
        <th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>byRating</td>
        <td>Name for this indexing rule</td>
      </tr>
      <tr>
        <td>unique</td>
        <td>false</td>
        <td>[true||false] If the index is unique i.e. if true there
        will be a unique index for each row, even if the row's entries
        are identical.</td>
      </tr>
    </table>
  </p>

  <p>Index should also contain a &lt;column/&gt; tag specifying on
    which database column this indexing rule should be applied.</p>

  <p>NB this indexing rule has nothing to do with the database's
     indexing rules, and is implemented entirely within the
     persistence layer.</p>

<p><a href="#top">top</a></p>

<!-- PRIMARYKEY -------------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="primaryKey">
         <th colspan="3">&lt;primaryKey&gt;</th></a>
      </tr>
    </table>
  </p>

  <p>The database column that is the primary key for this class</p>

  <p>
    <table width="100%">
      
    <tr><td width="20%"></td>
    
    <td width="80%">
    <table width="100%">
      <tr><a name="column">
        <th colspan="3">&lt;column A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
        <th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>INSTRUMENT_ID</td>
        <td>Name of column containing primary key</td>
      </tr>
      <tr>
        <td>tableName</td>
        <td>INSTRUMENT</td>
        <td>Name of the table containing this column</td>
      </tr>
      <tr>
        <td>idFactory</td>
        <td>org.bhavaya.db.IncrementMaxValueIdFactory</td>
        <td>Class to use if the persister is to automatically generate
            new primary keys when adding beans. The example class
            stated does a select max on the table each time it has to 
	    generate a key and so should not be used if the tables are 
	    expected to be large.</td>
      </tr>
    </table>
    </td></tr>

    </table>
  </p>

<p><a href="#top">top</a></p>

<!-- OPERATION --------------------------------------------------------------->
  <p>
    <table width="100%">
      <tr><a name="operation">
        <th colspan="3">&lt;operation A="B" ... &gt;</th></a>
      </tr>
      <tr>
        <th>A</th>
        <th>B - example value</th>
	<th>description</th>
      </tr>
      <tr>
        <td>name</td>
        <td>getInfo</td>
        <td></td>
      </tr>
      <tr>
        <td>transformClass</td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>index</td>
        <td></td>
        <td></td>
      </tr>
    </table>
  </p>

  <p>
  
    <table width="100%">
      
      <tr><td width="20%"></td>
    
        <td width="80%">
    
          <table>
          <tr>
            <th colspan="3" width="100%">&lt;keyTransform A="B" ...&gt;</th>
          </tr>
          <tr>
            <th>A</th>
	    <th>B - example value</th>
  	    <th>description</th>
          </tr>
          <tr>
            <td>class</td>
       	    <td></td>
	    <td></td>
          </tr>
	</table>

      </tr>
    </table>
  
  </p>
  
  <p>
  
    <table width="100%">
      
      <tr><td width="20%"></td>
    
        <td width="80%">
    
          <table width="100%">
          <tr>
            <th colspan="3" width="100%">&lt;defaultValue A="B" ...&gt;</th>
          </tr>
          <tr>
            <td colspan="3">See <a href="#defaultvalue">defaultValue</a>
            at constructorProperty.</td>
          </tr>
	</table>

      </tr>
    </table>
  
  </p>

  <p><a href="#top">top</a></p>

  <p><a href="persistence.html">back</a></p>

<!-- Navigation menu -->
<p><br></p>
<div class="toplinks" id="banner">
    <p>
    <table border="0" cellspacing="0" cellpadding="0"  width="100%">
        <tr>
            <td><a href="../intro.html">Bhavaya&nbsp;Home</a></td>
            <td><a href="../overview.html">Overview</a></td>
            <td><a href="../architecture.html">Architecture</a></td>
            <td><a href="../quickstart.html">Quickstart</a></td>
            <td><a href="../download.html">Download</a></td>
	    <td><a href="../feedback.html">Feedback</a></td>
        </tr>
    </table>
    </p>
</div>
<!-- Navigation Menu -->


</div>
</div>
</body>
</html>
